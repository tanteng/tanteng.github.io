<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Laravel 5.2自带用户注册和登录认证 &middot; TonyTan</title>

  
  <link rel="stylesheet" href="http://tanteng.me/css/poole.css">
  <link rel="stylesheet" href="http://tanteng.me/css/hyde.css">
  <link rel="stylesheet" href="http://tanteng.me/css/poole-overrides.css">
  <link rel="stylesheet" href="http://tanteng.me/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://tanteng.me/css/hyde-x.css">
  <link rel="stylesheet" href="http://tanteng.me/css/highlight/sunburst.css">
  
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://tanteng.me/touch-icon-144-precomposed.png">
  <link href="http://tanteng.me/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Your default page description">
  <meta name="keywords" content="your,default,page,keywords">
  
</head>
<body class="theme-base-0d">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://tanteng.me/"><h1>小谈博客</h1></a>
      <p class="lead">
       一个专注WEB技术的博客 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://tanteng.me/">Blog</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/tanteng"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a href="https://www.linkedin.com/in/tanteng"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://www.instagram.com/tanteng1031"><i class="fa fa-instagram fa-3x"></i></a>
      <a href="https://www.facebook.com/tanteng001"><i class="fa fa-facebook-square fa-3x"></i></a>
      
      
      
      </li>
    </ul>

    

    <p>Copyright &copy; 2019 <a href="http://tanteng.me/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Laravel 5.2自带用户注册和登录认证</h1>
    <span class="post-date">Feb 19, 2016 &middot; 1 minute read
    
    <br/>
    <a class="label" href="http://tanteng.me/categories/develop">Develop</a><a class="label" href="http://tanteng.me/categories/laravel">Laravel</a><a class="label" href="http://tanteng.me/categories/php">PHP</a>
    </span>
    <p>Laravel 5.2自带用户注册和登录认证，安装好Laravel后，在app根目录执行php artisan make:auth,即可自动安装一个简易的功能完整的用户认证系统。</p>

<p><img class="alignnone wp-image-9509 size-full" src="https://blog.tanteng.me/wp-content/uploads/2016/02/laravel-login.png" alt="laravel-login" width="750" height="460" /></p>

<p>在路由定义文件routes.php中，发现多了一个路由配置：</p>

<pre class="lang:php decode:true">Route::group(['middleware' =&gt; 'web'], function () {
    Route::auth();

    Route::get('/home', 'HomeController@index');
});</pre>

<p>因此输入www.example.com/home，由于用户没有登录自动转向到登录也没，如上图所示。</p>

<p>看看HomeController控制器：</p>

<pre class="lang:php decode:true ">&lt;?php
namespace App\Http\Controllers;

use App\Http\Requests;

class HomeController extends Controller
{
    public function __construct()
    {
        $this-&gt;middleware('auth');
    }

    public function index()
    {
        return view('home');
    }
}</pre>

<p>很简单，使用auth中间件，如果通过auth中间件则显示home视图。</p>

<p><strong>那么重点就是auth中间件。</strong></p>

<p>在Kernel.php中查看auth中间件的定义：</p>

<pre class="lang:php decode:true ">protected $routeMiddleware = [
    'auth' =&gt; \App\Http\Middleware\Authenticate::class,
    'auth.basic' =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
    'guest' =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,
    'throttle' =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,
];</pre>

<p>打开app/Http/Middleware/Authenticate.php文件查看handle方法：</p>

<pre class="lang:php decode:true ">public function handle($request, Closure $next, $guard = null)
{
    if (Auth::guard($guard)-&gt;guest()) {
        if ($request-&gt;ajax()) {
            return response('Unauthorized.', 401);
        } else {
            return redirect()-&gt;guest('login');
        }
    }

    return $next($request);
}</pre>

<p>这里使用了Laravel自带的用户认证Auth，如果没有登录跳转到login，可以login路由在哪定义的呢？还有www.example.com/regisger等路由没看到定义的地方呀。</p>

<p>在终端执行php artisan route:list发现注册了这么多路由，包括很多认证的路由：</p>

<p><a href="https://blog.tanteng.me/wp-content/uploads/2016/02/routelist.png" target="_blank"><img class="alignnone wp-image-9510 size-full" src="https://blog.tanteng.me/wp-content/uploads/2016/02/routelist.png" alt="routelist" width="1203" height="482" srcset="https://blog.tanteng.me/wp-content/uploads/2016/02/routelist.png 1203w, https://blog.tanteng.me/wp-content/uploads/2016/02/routelist-768x308.png 768w" sizes="(max-width: 767px) 89vw, (max-width: 1000px) 54vw, (max-width: 1071px) 543px, 580px" /></a></p>

<p>这些路由是经过前面路由文件中的Route::auth()来进行注册的。</p>

<p>auth方法具体位置vendor/laravel/framework/src/Illuminate/Routing/Router.php，其中auth方法：</p>

<pre class="lang:php decode:true ">public function auth()
{
    // Authentication Routes...
    $this-&gt;get('login', 'Auth\AuthController@showLoginForm');
    $this-&gt;post('login', 'Auth\AuthController@login');
    $this-&gt;get('logout', 'Auth\AuthController@logout');

    // Registration Routes...
    $this-&gt;get('register', 'Auth\AuthController@showRegistrationForm');
    $this-&gt;post('register', 'Auth\AuthController@register');

    // Password Reset Routes...
    $this-&gt;get('password/reset/{token?}', 'Auth\PasswordController@showResetForm');
    $this-&gt;post('password/email', 'Auth\PasswordController@sendResetLinkEmail');
    $this-&gt;post('password/reset', 'Auth\PasswordController@reset');
}</pre>

<p>当你登录过再次进入www.example.com/login，会被自动跳转到首页，这里也是用到了中间件，如上面列出的中间件中的guest，看看app/Http/Middleware/RedirectIfAuthenticated.php中的handle方法：</p>

<pre class="lang:php decode:true">public function handle($request, Closure $next, $guard = null)
{
    if (Auth::guard($guard)-&gt;check()) {
        return redirect('/');
    }

    return $next($request);
}</pre>

<p>Laravel本身自带了用户注册、登录、密码重置等基本的用户验证功能，并且自带认证方法，视图，路由，开箱即用。</p>
  </div>
  
</div>




<script src="http://tanteng.me/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

