<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Redis有序集合常用命令 &middot; TonyTan</title>

  
  <link rel="stylesheet" href="http://tanteng.me/css/poole.css">
  <link rel="stylesheet" href="http://tanteng.me/css/hyde.css">
  <link rel="stylesheet" href="http://tanteng.me/css/poole-overrides.css">
  <link rel="stylesheet" href="http://tanteng.me/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://tanteng.me/css/hyde-x.css">
  <link rel="stylesheet" href="http://tanteng.me/css/highlight/sunburst.css">
  
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://tanteng.me/touch-icon-144-precomposed.png">
  <link href="http://tanteng.me/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Your default page description">
  <meta name="keywords" content="your,default,page,keywords">
  
</head>
<body class="theme-base-0d">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://tanteng.me/"><h1>小谈博客</h1></a>
      <p class="lead">
       一个专注WEB技术的博客 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://tanteng.me/">Blog</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/tanteng"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a href="https://www.linkedin.com/in/tanteng"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://www.instagram.com/tanteng1031"><i class="fa fa-instagram fa-3x"></i></a>
      <a href="https://www.facebook.com/tanteng001"><i class="fa fa-facebook-square fa-3x"></i></a>
      
      
      
      </li>
    </ul>

    

    <p>Copyright &copy; 2019 <a href="http://tanteng.me/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Redis有序集合常用命令</h1>
    <span class="post-date">Jul 19, 2016 &middot; 2 minute read
    
    <br/>
    <a class="label" href="http://tanteng.me/categories/develop">Develop</a><a class="label" href="http://tanteng.me/categories/redis">Redis</a><a class="label" href="http://tanteng.me/categories/%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a>
    </span>
    <p>小结一下Redis有序集合的常用命令有：zadd,zrange,zremrangebyrank,zremrangebyscore,zcard等，这些都是使用频率比较高的，还有一些参数的说明等。</p>

<h3 id="zadd命令">ZADD命令</h3>

<blockquote>
<p>将一个或多个 <code class="docutils literal">&lt;span class=&ldquo;pre&rdquo;&gt;member&lt;/span&gt;</code> 元素及其 <code class="docutils literal">&lt;span class=&ldquo;pre&rdquo;&gt;score&lt;/span&gt;</code> 值加入到有序集 <code class="docutils literal">&lt;span class=&ldquo;pre&rdquo;&gt;key&lt;/span&gt;</code> 当中。</p>

<p>如果某个 <code class="docutils literal">&lt;span class=&ldquo;pre&rdquo;&gt;member&lt;/span&gt;</code> 已经是有序集的成员，那么更新这个 <code class="docutils literal">&lt;span class=&ldquo;pre&rdquo;&gt;member&lt;/span&gt;</code> 的 <code class="docutils literal">&lt;span class=&ldquo;pre&rdquo;&gt;score&lt;/span&gt;</code> 值，并通过重新插入这个 <code class="docutils literal">&lt;span class=&ldquo;pre&rdquo;&gt;member&lt;/span&gt;</code> 元素，来保证该 <code class="docutils literal">&lt;span class=&ldquo;pre&rdquo;&gt;member&lt;/span&gt;</code> 在正确的位置上。</p>

<p><code class="docutils literal">&lt;span class=&ldquo;pre&rdquo;&gt;score&lt;/span&gt;</code> 值可以是整数值或双精度浮点数。</p>
</blockquote>

<p>先用zadd命令批量添加一些元素到有序集合中，后面的操作都是基于这个集合进行。</p>

<pre class="lang:vim decode:true">127.0.0.1:6379&gt; zadd myzadd 1 a 2 b 3 c 4 d 5 e 6 f 7 d 8 e 9 f 10 tanteng.me
(integer) 7</pre>

<p>如图所示：</p>

<p><a href="https://blog.tanteng.me/wp-content/uploads/2016/07/myzadd.png" target="_blank"><img class="alignnone size-full wp-image-10293" src="https://blog.tanteng.me/wp-content/uploads/2016/07/myzadd.png" alt="myzadd" width="375" height="172" /></a></p>

<p>有序集合最特别的地方在于score，有了分值可以做很多事情，这个score不仅可以理解为分值，有时也会存时间戳，或者ip的整形形式，可以灵活运用。</p>

<h3 id="zrange命令">ZRANGE命令</h3>

<p>语法：ZRANGE key start stop [WITHSCORES]</p>

<p>zrange命令用于返回有序集合中给定区间的元素。start从0开始，stop是结束下标，如果是负数表示从倒数开始，-1倒数第一个，-2倒数第二个……</p>

<p>看下面的操作一目了然。</p>

<pre class="lang:vim decode:true">127.0.0.1:6379&gt; zrange myzadd 0 1
1) "a"
2) "b"
127.0.0.1:6379&gt; zrange myzadd 0 5
1) "a"
2) "b"
3) "c"
4) "d"
5) "e"
6) "f"
127.0.0.1:6379&gt; zrange myzadd 1 5
1) "b"
2) "c"
3) "d"
4) "e"
5) "f"
127.0.0.1:6379&gt; zrange myzadd 0 -1
1) "a"
2) "b"
3) "c"
4) "d"
5) "e"
6) "f"
7) "tanteng.me"</pre>

<p>加上WITHSCORES参数显示分值：</p>

<pre class="lang:vim decode:true ">127.0.0.1:6379&gt; zrange myzadd 0 -1 WITHSCORES
 1) "a"
 2) "1"
 3) "b"
 4) "2"
 5) "c"
 6) "3"
 7) "d"
 8) "7"
 9) "e"
10) "8"
11) "f"
12) "9"
13) "tanteng.me"
14) "10"</pre>

<h3 id="zremrangebyrank命令">ZREMRANGEBYRANK命令</h3>

<p>语法：ZREMRANGEBYRANK key start stop</p>

<p>移除有序集中指定排名(rank)区间内的所有成员。start从0开始，stop可以为负数，表示倒过来第几位。</p>

<pre class="lang:vim decode:true">127.0.0.1:6379&gt; zremrangebyrank myzadd 0 2
(integer) 3</pre>

<p>执行这个命令就删除了前三个元素a,b,c.</p>

<h3 id="zremrangebyscore命令">ZREMRANGEBYSCORE命令</h3>

<p>语法：ZREMRANGEBYSCORE key min max</p>

<p>移除有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。</p>

<pre class="lang:vim decode:true ">127.0.0.1:6379&gt; zremrangebyscore myzadd 7 8
(integer) 2</pre>

<p>这样一来就把分值是7和8的元素d,e移除了.</p>

<p>ZREMRANGEBYRANK和ZREMRANGEBYSCORE从字面上很好理解，都是移除元素，一个根据下标，一个根据分值。</p>

<h3 id="zcard命令">ZCARD命令</h3>

<p>语法：ZCARD key</p>

<p>返回有序集合的基数。</p>

<pre class="lang:vim decode:true ">127.0.0.1:6379&gt; zcard myzadd
(integer) 2</pre>

<p>经过前面的删除元素操作，现在只剩2个元素了。</p>

<h3 id="zcount命令">ZCOUNT命令</h3>

<p>语法：ZCOUNT key min max</p>

<p>ZCOUNT命令和ZCARD命令的不同是，ZCOUNT支持根据范围返回元素个数。</p>

<p>由于集合元素都差不多删没了，重新添加一组元素：</p>

<pre class="lang:vim decode:true ">127.0.0.1:6379&gt; zadd new 100 www.baidu.com 900 www.tanteng.me 12 www.yahoo.com 90 www.xunlei.com 88 www.juanpi.com
(integer) 5</pre>

<p>如图所示：</p>

<p><a href="https://blog.tanteng.me/wp-content/uploads/2016/07/newzadd.png" target="_blank"><img class="alignnone size-full wp-image-10297" src="https://blog.tanteng.me/wp-content/uploads/2016/07/newzadd.png" alt="newzadd" width="369" height="143" /></a></p>

<p>现在返回分值在80和100之间的成员数量。</p>

<pre class="lang:vim decode:true ">127.0.0.1:6379&gt; zcount new 80 100
(integer) 3</pre>

<p>返回3个。</p>

<p><strong>在Redis里面，还有个参数inf，-inf表示第一个成员，+inf表示最后一个。</strong></p>

<pre class="lang:vim decode:true ">127.0.0.1:6379&gt; zcount new 80 +inf
(integer) 4</pre>

<p>这里就返回4个数量，+inf这里表示没有限制最高分值的意思。</p>

<p><strong>（小谈博客原创，转载请注明出处和链接：<a href="https://blog.tanteng.me/2016/07/redis-sorted-set/" target="_blank"><a href="https://blog.tanteng.me/2016/07/redis-sorted-set/">https://blog.tanteng.me/2016/07/redis-sorted-set/</a></a>）</strong></p>

<p>更多其他命令和详细的用法请参考Redis手册：</p>

<p><a href="http://redisdoc.com/sorted_set/index.html" target="_blank" rel="nofollow"><a href="http://redisdoc.com/sorted_set/index.html">http://redisdoc.com/sorted_set/index.html</a></a></p>
  </div>
  
</div>




<script src="http://tanteng.me/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

