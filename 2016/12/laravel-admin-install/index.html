<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>Laravel 5.3 后台管理系统搭建 &middot; TonyTan</title>

  
  <link rel="stylesheet" href="http://tanteng.me/css/poole.css">
  <link rel="stylesheet" href="http://tanteng.me/css/hyde.css">
  <link rel="stylesheet" href="http://tanteng.me/css/poole-overrides.css">
  <link rel="stylesheet" href="http://tanteng.me/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://tanteng.me/css/hyde-x.css">
  <link rel="stylesheet" href="http://tanteng.me/css/highlight/sunburst.css">
  
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://tanteng.me/touch-icon-144-precomposed.png">
  <link href="http://tanteng.me/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="Your default page description">
  <meta name="keywords" content="your,default,page,keywords">
  
</head>
<body class="theme-base-0d">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://tanteng.me/"><h1>小谈博客</h1></a>
      <p class="lead">
       一个专注WEB技术的博客 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://tanteng.me/">Blog</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/tanteng"><i class="fa fa-github fa-3x"></i></a>
      
      
      <a href="https://www.linkedin.com/in/tanteng"><i class="fa fa-linkedin-square fa-3x"></i></a>
      <a href="https://www.instagram.com/tanteng1031"><i class="fa fa-instagram fa-3x"></i></a>
      <a href="https://www.facebook.com/tanteng001"><i class="fa fa-facebook-square fa-3x"></i></a>
      
      
      
      </li>
    </ul>

    

    <p>Copyright &copy; 2019 <a href="http://tanteng.me/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>

  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">Laravel 5.3 后台管理系统搭建</h1>
    <span class="post-date">Dec 24, 2016 &middot; 2 minute read
    
    <br/>
    <a class="label" href="http://tanteng.me/categories/develop">Develop</a><a class="label" href="http://tanteng.me/categories/laravel">Laravel</a><a class="label" href="http://tanteng.me/categories/php">PHP</a>
    </span>
    <p>网上的很多基于 Laravel 的后台管理系统，要么缺少基本的功能，要么太臃肿，总是找不到自己喜欢的，于是自己做了一个。它的特点是尽可能简单又不缺少基本的后台功能，如用户认证，基于角色的权限系统（Entrust），菜单管理，媒体管理等，并且使用 AdminLte 后台界面，外观简洁功能强大。</p>

<p>下面讲一讲 Laravel-admin 的安装步骤，或者一些不要的说明，可以使用本系统，但是更建议参考本后台搭建的方法自行弄一套更符合自己的后台管理系统，这种后台管理系统是可以复用到不同的项目中的。</p>

<h3 id="一-安装扩展包">一、安装扩展包</h3>

<p>使用自带的用户认证，权限管理基于 Entrust 扩展包，实现基于角色的权限控制系统，用于开发调试的 laravel-debugbar 扩展包，还有必不可少的操作 Redis 的扩展包。</p>

<p>本后台依赖的扩展包：</p>

<p>Entrust</p>

<p>Predis</p>

<p>laravel-debugbar</p>

<p>在 composer.json 中添加扩展包：</p>

<pre class="lang:default decode:true">"predis/predis": "^1.1",
"zizaco/entrust": "5.2.x-dev",
"barryvdh/laravel-debugbar": "^2.3"</pre>

<p>推荐安装最新版本。执行 sudo composer install 即可。</p>

<p><strong>重要：具体安装好扩展包之后，如果还需要进行的步骤，参考扩展包的官方 github 主页。</strong></p>

<p>这里自行还要操作的步骤还很多，如 Entrust 需要执行数据库迁徙文件，建立 Role 和 Permission 的模型，并且使用 Traits 等，按照 Entrust 的安装说明进行。关于 Entrust ，注意修改 config/entrust.php 中的模型对应的实际的类，如：</p>

<pre class="lang:php decode:true">'role' =&gt; 'App\Models\Role',</pre>

<h4 id="扩展包-github-主页">扩展包 github 主页：</h4>

<p>Entrust：<a href="https://github.com/Zizaco/entrust" target="_blank" rel="nofollow"><a href="https://github.com/Zizaco/entrust">https://github.com/Zizaco/entrust</a></a></p>

<p>Laravel-debugbar：<a href="https://github.com/barryvdh/laravel-debugbar" target="_blank" rel="nofollow"><a href="https://github.com/barryvdh/laravel-debugbar">https://github.com/barryvdh/laravel-debugbar</a></a></p>

<p>Predis: <a href="https://github.com/nrk/predis" target="_blank" rel="nofollow"><a href="https://github.com/nrk/predis">https://github.com/nrk/predis</a></a></p>

<h3 id="二-安装-adminlte-后台模板">二、安装 AdminLte 后台模板</h3>

<p>AdminLte 是一套完整的专业的后台模板，由静态页面和很多 js 组件构建，UI 简洁美观，github 上 Stars 数量很多，可以用来做通用的后台管理系统界面。</p>

<p>github 地址：<a href="https://github.com/almasaeed2010/AdminLTE">https://github.com/almasaeed2010/AdminLTE</a></p>

<p>这个就比较麻烦，把需要用到的 css，js，插件等文件夹复制到项目的 pubic 文件夹下，可以新建一个目录如 vendor，然后把登陆页面，后台主页面等 html 做成 blade 模板放到模板目录，如 resource/views/admin 目录下。</p>

<h3 id="三-后台管理路由">三、后台管理路由</h3>

<p>以 Laravel 5.3 为例，在 routes 目录下新增 admin.php 文件，在这个文件定义后台管理的路由，基本路由示例如下：</p>

<pre class="lang:php decode:true">&lt;?php
Route::get('/', function () {
    return view('admin.index');
})-&gt;middleware('auth:admin');
Route::get('/login', 'Admin\LoginController@showLoginForm');
Route::post('/login', 'Admin\LoginController@login');
Route::get('/logout', 'Admin\LoginController@logout');
Route::resource('/user', 'Admin\UserController');
Route::resource('/role', 'Admin\RoleController');
Route::resource('/permission', 'Admin\PermissionController');
Route::get('testEntrust', 'Admin\TestEntrustController@hello');
</pre>

<p>在 app/Providers/RouteServiceProvider.php 中添加方法，使用 web 中间件，并设置路由前缀为 admin，具体如下：</p>

<pre class="lang:php decode:true">/**
 * 后台管理路由
 */
protected function mapAdminRoutes()
{
    Route::group([
        'middleware' =&gt; 'web',
        'namespace' =&gt; $this-&gt;namespace,
        'prefix' =&gt; 'admin',
    ], function ($router) {
        require base_path('routes/admin.php');
    });
}</pre>

<p>别忘了在 map 方法中调用新增的方法，这样一个后台管理基本界面就好了。</p>

<h3 id="四-后台-auth-认证">四、后台 Auth 认证</h3>

<h4 id="增加一个-guard">增加一个 guard {.}</h4>

<p class="">
  后台身份认证和前台可以实现分开，在 config/auth.php 的 guards 数组中添加后台的 guard 定义：
</p>

<pre class="lang:php decode:true ">'guards' =&gt; [
    'web' =&gt; [
        'driver' =&gt; 'session',
        'provider' =&gt; 'users',
    ],

    'admin' =&gt; [
        'driver' =&gt; 'session',
        'provider' =&gt; 'users',
    ],

    'api' =&gt; [
        'driver' =&gt; 'token',
        'provider' =&gt; 'users',
    ],
],</pre>

<p>这里新增的 admin 定义跟 web 一样，只是共用 users 表作为后台的用户表，这里严格说应该分开，甚至把后台的数据库也独立，本文作为一个示例就不做很完善，这样也会把过程弄得很复杂，大概的思路 OK 了，可以根据自己的情况去搭建后台。</p>

<h4 id="判断后台未登陆跳转后台登陆页面">判断后台未登陆跳转后台登陆页面</h4>

<p class="">
  Laravel 5.3 将未登录作为一个异常进行处理，如果是后台未登录，则跳转到后台的登陆页面，需要在 app/Exceptions/Handler.php 文件修改 unauthenticated 方法如下：
</p>

<pre class="lang:php decode:true">protected function unauthenticated($request, AuthenticationException $exception)
{
    if ($request-&gt;expectsJson()) {
        return response()-&gt;json(['error' =&gt; 'Unauthenticated.'], 401);
    }

    //如果是后台页面未认证,跳转到后台登陆页面
    $guard = $exception-&gt;guards();
    if (in_array('admin', $guard)) {
        return redirect()-&gt;guest('/admin/login');
    }

    return redirect()-&gt;guest('login');
}</pre>

<h4 id="修改中间件">修改中间件</h4>

<p>如果已经登录后台，进入后台登录页面跳转到后台首页而无需再次登录，这个是由一个名为 guest 的中间件控制的。而默认会跳转到前台的页面，需要进行修改，文件位于 app/Http/Middleware/RedirectIfAuthenticated.php ，其中修改如下：</p>

<pre class="lang:php decode:true ">public function handle($request, Closure $next, $guard = null)
{
    if (Auth::guard($guard)-&gt;check()) {
        $redirect = $guard == 'admin' ? '/admin' : '/home';
        return redirect($redirect);
    }

    return $next($request);
}</pre>

<p>这样已经登录后台之后，再进入后台登录页面，会跳转到后台首页了，而不是前台页面。</p>

<h3 id="五-后台管理控制器">五、后台管理控制器</h3>

<p>后台管理控制器都在目录 app/Http/Controllers/Admin 下，定义好了需要用到的模型以及模型的关系后，那么主要的逻辑在这些控制器中，这是一些基本的后台功能。</p>

<p>至此，一个全新的基于 Laravel 5.3 的后台管理系统就搭建好了，有了这个后台，可以开发强大的功能了。</p>
  </div>
  
</div>




<script src="http://tanteng.me/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

