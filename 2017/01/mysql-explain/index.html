<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.55.6" />

    
    
    

<title>Mysql性能优化–Explain详解 • 小谈博客</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Mysql性能优化–Explain详解"/>
<meta name="twitter:description" content="EXPLAIN

mysql explain命令是查询性能优化不可缺少的一部分。

explain output columns




列名
说明





id
执行编号，标识select所属的行。如果在语句中没有子查询或者关联查询，只有唯一的select，每行都将显示1。否则，内层的select语句一般会顺序编号，对应于其在原始语句中的位置



select_type
显示本行是简单或是复杂select。如果查询有任何复杂的子查询，则最外层标记为primary（derived、Union、Union resuit）



table
访问引用哪个表（引用某个查询，如“derived3”）



partitions
匹配的分区



type
数据访问/读取操作类型（all、index、range、ref、eq_ref、const/system、NULL）。join类型



possible_keys
揭示哪一些索引可能有利于高效的查找



key
此次查询中确切使用到的索引.



key_len
显示mysql在索引里使用的字节数



ref
哪个字段或常数与key一起被使用



rows
为了找到所需的列而需要读取的行数，估算值，不精确。通过把所有rows列值相乘，可粗略估算整个查询会检查的行数



filtered
表示此查询条件所过滤的数据的百分比



Extra
额外信息，如using index、filesort等


"/>

<meta property="og:title" content="Mysql性能优化–Explain详解" />
<meta property="og:description" content="EXPLAIN

mysql explain命令是查询性能优化不可缺少的一部分。

explain output columns




列名
说明





id
执行编号，标识select所属的行。如果在语句中没有子查询或者关联查询，只有唯一的select，每行都将显示1。否则，内层的select语句一般会顺序编号，对应于其在原始语句中的位置



select_type
显示本行是简单或是复杂select。如果查询有任何复杂的子查询，则最外层标记为primary（derived、Union、Union resuit）



table
访问引用哪个表（引用某个查询，如“derived3”）



partitions
匹配的分区



type
数据访问/读取操作类型（all、index、range、ref、eq_ref、const/system、NULL）。join类型



possible_keys
揭示哪一些索引可能有利于高效的查找



key
此次查询中确切使用到的索引.



key_len
显示mysql在索引里使用的字节数



ref
哪个字段或常数与key一起被使用



rows
为了找到所需的列而需要读取的行数，估算值，不精确。通过把所有rows列值相乘，可粗略估算整个查询会检查的行数



filtered
表示此查询条件所过滤的数据的百分比



Extra
额外信息，如using index、filesort等


" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://tanteng.me/2017/01/mysql-explain/" />
<meta property="article:published_time" content="2017-01-19T09:07:43&#43;00:00"/>
<meta property="article:modified_time" content="2017-01-19T09:07:43&#43;00:00"/>


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.5908340ec0d0531feb30d45d7ab9a057fcd461f5bda26b1c817b70b1565424bb.css" integrity="sha256-WQg0DsDQUx/rMNRdermgV/zUYfW9omscgXtwsVZUJLs=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="http://tanteng.me/">小谈博客</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="http://tanteng.me/img/avatar.jpeg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         一个专注 WEB 技术的博客 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">小谈博客</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	
	<a href="https://facebook.com/tanteng001" rel="me"><i class="fab fa-facebook-f"></i></a>
	
	
	<a href="https://github.com/tanteng" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	<a href="https://instagram.com/tanteng1031" rel="me"><i class="fab fa-instagram fa-lg" aria-hidden="true"></i></a>
	
	
	<a href="https://linkedin.com/in/tanteng" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 TonyTan
  
</div>



  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Mysql性能优化–Explain详解</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Jan 19, 2017
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/develop">DEVELOP</a>
              •
          
              <a class="badge badge-category" href="/categories/mysql">MYSQL</a>
              •
          
              <a class="badge badge-category" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a>
              
          
      
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 5 min read
</div>


  </header>
  
  
  <div class="post">
    <h3 id="explain">EXPLAIN</h3>

<p>mysql explain命令是查询性能优化不可缺少的一部分。</p>

<h4 id="toc_1">explain output columns</h4>

<table>
<thead>
<tr>
<th>列名</th>
<th>说明</th>
</tr>
</thead>

<tbody>
<tr>
<td>id</td>
<td>执行编号，标识select所属的行。如果在语句中没有子查询或者关联查询，只有唯一的select，每行都将显示1。否则，内层的select语句一般会顺序编号，对应于其在原始语句中的位置</td>
</tr>

<tr>
<td>select_type</td>
<td>显示本行是简单或是复杂select。如果查询有任何复杂的子查询，则最外层标记为primary（derived、Union、Union resuit）</td>
</tr>

<tr>
<td>table</td>
<td>访问引用哪个表（引用某个查询，如“derived3”）</td>
</tr>

<tr>
<td>partitions</td>
<td>匹配的分区</td>
</tr>

<tr>
<td>type</td>
<td>数据访问/读取操作类型（all、index、range、ref、eq_ref、const/system、NULL）。join类型</td>
</tr>

<tr>
<td>possible_keys</td>
<td>揭示哪一些索引可能有利于高效的查找</td>
</tr>

<tr>
<td>key</td>
<td>此次查询中确切使用到的索引.</td>
</tr>

<tr>
<td>key_len</td>
<td>显示mysql在索引里使用的字节数</td>
</tr>

<tr>
<td>ref</td>
<td>哪个字段或常数与key一起被使用</td>
</tr>

<tr>
<td>rows</td>
<td>为了找到所需的列而需要读取的行数，估算值，不精确。通过把所有rows列值相乘，可粗略估算整个查询会检查的行数</td>
</tr>

<tr>
<td>filtered</td>
<td>表示此查询条件所过滤的数据的百分比</td>
</tr>

<tr>
<td>Extra</td>
<td>额外信息，如using index、filesort等</td>
</tr>
</tbody>
</table>

<h4 id="toc_2">id</h4>

<p>id是用来顺序标识整个查询中select语句的，在嵌套查询中id越大的语句越先执行。该值可能为null，说明这一行用来表示其他行的联合查询结果。</p>

<h4 id="toc_3">select_type</h4>

<p><code>select_type</code> 表示了查询的类型, 它的常用取值有:</p>

<ul>
<li>SIMPLE，表示此查询不包含UNION查询或者子查询</li>
<li>PRIMARY，表示此查询是最外层的查询</li>
<li>UNION，表示此查询是UNION的第二或随后的查询</li>
<li>DEPENDENT UNION, UNION中的第二或后面的查询语句，取决于外面的查询</li>
<li>UNION RESULT，UNION的结果</li>
<li>SUBQUERY， 子查询中的第一个SELECT</li>
<li>DEPENDENT SUBQUERY：子查询中第一个SELECT，取决于外面的查询，即子查询依赖于外层查询的结果。</li>
</ul>

<h4 id="toc_4">table</h4>

<p>表示查询设计的表或者衍生表（表别名）</p>

<ul>
<li>关联优化器会为查询选择关联顺序，左侧深度优先</li>
<li>当from中有子查询的时候，表名是derivedN的形式，N指向子查询，也就是explain结果中的下一列</li>
<li>当有Union result的时候，表名是Union 1，2等形式，1，2表示参与Union的query id</li>
<li>注意：mysql对待这些表和普通表一样，但是临时表是没有任何索引的。</li>
</ul>

<h4 id="toc_5">type</h4>

<p><code>type</code>字段比较重要，它提供了判断查询是否高效的重要依据，通过<code>type</code>字段我们判断此查询是<code>全表扫描</code>还是<code>索引扫描</code>等。</p>

<ul>
<li><code>system</code>：表中只有一条数据，这个类型是特殊的<code>const</code>类型</li>
<li><code>const</code>：针对主键或唯一索引的等值查询扫描，最多只返回一行数据，const查询速度非常快，因为它仅仅读取一次即可。</li>
<li><code>eq_ref</code>：此类型通常出现在多表的join查询，表示对于前表的每个结果，都只匹配到后表的一行结果，并且查询的比较操作通常是<code>=</code>，查询效率高。</li>
<li><code>ref</code>：此类型通常出现在多表的join查询，针对于非唯一或非主键索引，或者使用了<code>最左前缀</code>规则索引的查询。</li>
<li><code>range</code>：表示使用索引范围查询，通过索引字段范围获取表中部分数据记录，这个通常出现在： =, &lt;&gt;, &gt;, &gt;=, &lt;, &lt;=, IS NULL, &lt;=&gt;, BETWEEN, IN() 操作中。当type=range时，ref字段为null，并且key_len字段是此次查询中使用到的索引的最长的那个。</li>
<li><code>index</code>：表示全索引扫描（full index scan）， 和ALL类型类似，只不过ALL类型是全表扫描，而index类型则仅仅扫描所有的索引，而不扫描数据。index通常出现在：所要查询的数据直接在索引树种就可以获取到，而不需要扫描数据，当是这种情况时，extra字段会显示<code>Using index</code>。</li>
<li><code>ALL</code>：表示全表扫描，这个类型的查询是性能最差的查询之一，通常来说，我们的查询不应该出现ALL类型的查询，因为这样的查询在数据量大的情况下，对数据库的性能是巨大的灾难，一般可以用索引来避免</li>
</ul>

<p><strong>type类型的性能比较</strong></p>

<p><code>ALL &lt; index &lt; range ≈ index_merge &lt; ref &lt; eq_ref &lt; const &lt; system</code></p>

<h4 id="toc_6">possible_keys</h4>

<p><code>possible_keys</code>表示mysql在查询时，能够使用到的索引，注意，即使有些索引在<code>possible_keys</code>中出现，但是不表示此索引会真正被Mysql使用到，Mysql在查询时具体使用了哪些索引，由<code>key</code>字段决定。</p>

<h4 id="toc_7">key</h4>

<p>此字段是mysql在当前查询时所真正使用到的索引</p>

<h4 id="toc_8">key_len</h4>

<p>表示查询优化器使用了索引的字节数，这个字段可以评估组合索引是否完全被使用，或只有最左部分字段被使用到。根据数据类型所占字节数计算出来。</p>

<ul>
<li>字符串

<ul>
<li>char(n): n 字节长度</li>
<li>varchar(n): 如果是 utf8 编码, 则是 3 n + 2字节; 如果是 utf8mb4 编码, 则是 4 n + 2 字节.</li>
</ul></li>
<li>数值类型:

<ul>
<li>TINYINT: 1字节</li>
<li>SMALLINT: 2字节</li>
<li>MEDIUMINT: 3字节</li>
<li>INT: 4字节</li>
<li>BIGINT: 8字节</li>
</ul></li>
<li>时间类型

<ul>
<li>DATE: 3字节</li>
<li>TIMESTAMP: 4字节</li>
<li>DATETIME: 8字节</li>
</ul></li>
<li>字段属性: NULL 属性 占用一个字节. 如果一个字段是 NOT NULL 的, 则没有此属性.</li>
</ul>

<h4 id="toc_9">rows</h4>

<p>rows也是一个重要的字段，mysql查询优化器根据统计信息，估算SQL要查找到结果集需要扫描读取的数据行数。这个值非常直观显示SQL的效率好坏，原则上rows越少越好。</p>

<h4 id="toc_10">Extra</h4>

<p>explain中很多额外的信息都会在extra中显示，常见以下内容：</p>

<ul>
<li>Using filesort，表示mysql需额外的排序操作，不能通过索引顺序达到排序效果，一般有Using filesort，都建议优化去掉，因为这样的查询CPU资源消耗大。</li>
<li>Using index，“覆盖索引扫描”，表示查询在索引树中就可以查询到所需数据，不用扫描表数据问题，往往说明性能挺好。</li>
<li>Using temporary，查询有使用临时表，一般出现于排序，分组和多表join的情况，查询效率不高，建议优化。</li>
</ul>
  </div>
  

<div class="navigation navigation-single">
    
    <a href="/2017/01/linux-postfix-maildrop/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">Linux 中 /var/spool/postfix/maildrop 占用空间很大的原因</span>
    </a>
    
    
    <a href="/2017/01/php-pack/" class="navigation-next">
      <span class="navigation-tittle">PHP二进制封包</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script src="https://cdn.bootcss.com/font-awesome/5.5.0/js/all.min.js"></script>

    
    
        <script src="https://cdn.bootcss.com/highlight.js/9.13.1/highlight.min.js"></script>
        
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
